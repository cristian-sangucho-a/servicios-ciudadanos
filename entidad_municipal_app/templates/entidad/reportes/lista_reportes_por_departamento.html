{% extends 'base.html' %}

{% block content %}
<div class="bg-white shadow rounded-lg p-6">
    <h1 class="text-2xl font-bold text-gray-900 mb-4">
        <i class="fas fa-file-alt mr-2"></i>
        Reportes Municipales por Departamento
    </h1>

    <!-- Filtro por departamento -->

    <!-- Tabla de reportes -->
    <div class="overflow-x-auto">
        <table class="min-w-full bg-white border border-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Prioridad</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Departamento</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Evidencia</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"> Acciones</th>

                </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
                {% for reporte in reportes %}
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ reporte.id }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            {% if reporte.estado == "asignado" %}
                                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                                    Asignado
                                </span>
                            {% else %}
                                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800">
                                    {{ reporte.estado|title }}
                                </span>
                            {% endif %}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            {{ reporte.reporte_ciudadano.prioridad }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            {{ reporte.departamento_nombre }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            {% if reporte.evidencia %}
                                {{ reporte.evidencia }}
                            {% else %}
                                Sin evidencia
                            {% endif %}
                        </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 rounded-r-lg">
                        <!-- BotÃ³n para postergar -->
                        <form action="{% url 'postergar_reporte' reporte.id %}" method="post" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="bg-yellow-400 text-gray-900 px-4 py-2 rounded-full shadow hover:bg-yellow-500 transition">
                                Postergar
                            </button>
                        </form>
                          <form action="{% url 'resolver_reporte' reporte.id %}" method="post" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" class="bg-green-400 text-gray-900 px-4 py-2 rounded-full shadow hover:bg-green-500 transition">
                            Resolver
                        </button>
                    </form>

                    </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="5" class="px-6 py-4 text-center text-gray-500">No hay reportes para este departamento.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
